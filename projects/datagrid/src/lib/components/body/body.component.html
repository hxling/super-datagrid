<!--
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-09 18:19:52
 * @QQ: 1055818239
 * @Version: v0.0.1
 -->
<div  class="f-datagrid-body" [ngStyle]="bodyStyle" [style.top.px]="top">

    <div [scrollbar]="psConfig" class="ps f-datagrid-body-wheel-area" #ps="ngxScrollbar"
        [ngStyle]="bodyStyle" (psXReachEnd)="onPsXReachEnd($event)"
        (psScrollY)="onScrollToY($event)"
        (psScrollX)="onScrollToX($event)" (psXReachStart)="onPsXReachStart($event)">
       
        <div [style.height.px]="wheelHeight" [style.width.px]="columnsGroup?.totalWidth" class="f-datagrid-bg">

            <div #fixedLeft class="f-datagrid-body-fixed-left"  [class.f-datagrid-fixed-left-shadow]="!!scrollLeft"
                *ngIf="dg.showLineNumber || dg.showCheckbox " [style.transform]="'translate3d('+ scrollLeft +'px, '+ topHideHeight +'px, 0px)'"
                [style.width.px]="leftFixedWidth" [style.height.px]="wheelHeight - topHideHeight">

                <table style="width: 100%" cellpadding="0" cellspacing="0" >
                    <colgroup>
                        <col [style.width.px]="dg.lineNumberWidth" *ngIf="dg.showLineNumber"/>
                        <col width="36px" *ngIf="dg.showCheckbox"/>
                        <col *ngFor="let col of columnsGroup?.leftFixed" [style.width.px]="col.width"/>
                    </colgroup>

                    <ng-container *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">


                        <ng-container *ngIf="dg.groupRows">
                            
                            <tr *ngIf="row[isGroupRow]" class="f-datagrid-body-row fixed-left-row f-datagrid-group-row" [style.height.px]="rowHeight" [attr.index]="startRowIndex + i">
                                
                                <ng-container *ngIf="dg.showLineNumber && dg.showCheckbox; else groupActionCell">
                                    <td class="f-datagrid-cell f-datagrid-cell-rownumber"></td>
                                    <td class="f-datagrid-cell f-datagrid-cell-checkbox">
                                        <span class="f-icon f-icon-plus f-datagrid-group-expanded" *ngIf="!row.expanded" (click)="toggleGroupRow(row, true)"></span>
                                        <span class="f-icon f-icon-minus f-datagrid-group-collapsed" *ngIf="row.expanded" (click)="toggleGroupRow(row, false)"></span>
                                    </td>
                                </ng-container>
                                
                                <ng-template #groupActionCell>
                                    <td *ngIf="dg.showLineNumber || dg.showCheckbox" class="f-datagrid-cell f-datagrid-group-action" >
                                        <span class="f-icon f-icon-plus f-datagrid-group-expanded" *ngIf="!row.expanded" (click)="toggleGroupRow(row, true)"></span>
                                        <span class="f-icon f-icon-minus f-datagrid-group-collapsed" *ngIf="row.expanded" (click)="toggleGroupRow(row, false)"></span>
                                    </td>
                                </ng-template>
                                
                            </tr>

                            <ng-container *ngIf="!row[isGroupRow]">

                                <ng-container *ngIf="row[isGroupFooter]">
                                    <tr class="f-datagrid-body-row fixed-left-row f-datagrid-group-footer" [style.height.px]="rowHeight" [attr.index]="startRowIndex + i"
                                        [style.display]="row[groupRow].expanded ? '': 'none'"
                                    >
                                        <td *ngIf="dg.showLineNumber" class="f-datagrid-cell f-datagrid-cell-rownumber"></td>
                                        <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox"></td>
                                    </tr>
                                </ng-container>
                                <ng-container *ngIf="!row[isGroupFooter]">
                                    <tr class="f-datagrid-body-row fixed-left-row" [style.height.px]="rowHeight" [attr.index]="startRowIndex + i"
                                        [class.f-datagrid-row-selected]="currentRowId === row[dg.idField]"
                                        [grid-row]="row" [row-hover]="row" [rowIndex]="startRowIndex + i"
                                        [style.display]="row[groupRow].expanded ? '': 'none'"
                                    >
                                        <td *ngIf="dg.showLineNumber" class="f-datagrid-cell f-datagrid-cell-rownumber" >
                                            {{ dg.pageSize * (dg.pageIndex-1) + startRowIndex + row[rowIndexFieldWithGroupRows] + 1 }}
                                        </td>
                
                                        <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center">
                                            <datagrid-checkbox [rowData]="row" [rowIndex]="startRowIndex + i" [checked]="isChecked(row)"></datagrid-checkbox>
                                        </td>
                                    </tr>
                                    
                                </ng-container>

                            </ng-container>
                            
                        </ng-container>

                        <ng-container *ngIf="!dg.groupRows">
                            <tr class="f-datagrid-body-row fixed-left-row" [style.height.px]="rowHeight" [attr.index]="startRowIndex + i"
                                [class.f-datagrid-row-selected]="currentRowId === row[dg.idField]"
                                [grid-row]="row" [row-hover]="row" [rowIndex]="startRowIndex + i"
                            >
                                <td *ngIf="dg.showLineNumber" class="f-datagrid-cell f-datagrid-cell-rownumber" >
                                    {{ dg.pageSize * (dg.pageIndex-1) + startRowIndex + i + 1 }}
                                </td>
        
                                <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center"><!-- style="width: 36px; text-align: center;"-->
                                    <datagrid-checkbox [rowData]="row" [rowIndex]="startRowIndex + i" [checked]="isChecked(row)"></datagrid-checkbox>
                                </td>
                                
                                <ng-container *ngIf="columnsGroup && columnsGroup.leftFixed">
                                    <td [cell-editable]="row" [column]="col" [attr.field]="col.field"
                                        class="f-datagrid-cell" [attr.align]="col.align" *ngFor="let col of columnsGroup?.leftFixed; let ci = index;">
                                        <grid-body-cell [width]="col.width" [height]="dg.rowHeight" [column]="col" [rowData]="row" [rowIndex]="startRowIndex + i"></grid-body-cell>
                                    </td>
                                </ng-container>
                            </tr>
                        </ng-container>


                    </ng-container>
                    

                    
                </table>
            </div>

            <div #fixedRight class="f-datagrid-body-fixed-right" [style.width.px]="rightFixedWidth" 
                *ngIf="columnsGroup?.rightFixed && columnsGroup?.rightFixed.length"
                [style.transform]="'translate3d('+ fixedRightScrollLeft +'px, '+ topHideHeight +'px, 0px)'"
                [class.f-datagrid-fixed-right-shadow]="showRightShadow" [style.height.px]="wheelHeight - topHideHeight">
                
                <datagrid-rows #mainTable [startRowIndex]="startRowIndex" [columns]="columnsGroup?.rightFixed" [data]="data"></datagrid-rows>
            </div>

            <div #main [style.width.px]="colsWidth" style="position: relative;" [style.left.px]="leftFixedWidth" class="f-datagrid-table"
                [style.transform]="'translate3d(0px, '+ topHideHeight +'px, 0px)'" [style.height.px]="wheelHeight - topHideHeight">

                <datagrid-rows #tableRows [startRowIndex]="startRowIndex" [columns]="columnsGroup?.normalColumns" [data]="data"></datagrid-rows>
               
            </div>
           
        </div>
    </div>
</div>